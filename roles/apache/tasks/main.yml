---
- name: Install apache
  apt: name={{ item }} state=present
  with_items:
   - apache2

- name: Install site config
  template: src=default.conf dest=/etc/apache2/sites-available/{{ apache.server_name|lower|replace('.', '_') }}.conf

- name: a2ensite {{ apache.site_name }}
  command: a2ensite {{ apache.server_name|lower|replace('.', '_') }}
  args:
    creates: /etc/apache2/sites-enabled/{{ {{ apache.server_name|lower|replace('.', '_') }} }}.conf
  notify:
    - restart apache2

- name: apache service state
  service: name=apache2 state=started enabled=yes